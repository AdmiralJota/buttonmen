#!/bin/sh
##### Run all ButtonMen CLI audit and test scripts

RETVAL=0

# Run audit script to verify PHP file layout
echo "Auditing PHP file locations"
php /buttonmen/deploy/pagodabox/audit_php_files.php /buttonmen/
if [ "$?" = "0" ]; then
  echo "Passed"
else
  echo "FAILED: make sure this passes before committing code"
  RETVAL=1
fi

echo
echo "------------------------------------------------------------------------" 

# Run audit script to verify JS unit test coverage
echo "Auditing JS unit test coverage locations"
/usr/local/bin/audit_js_unit_test_coverage
if [ "$?" = "0" ]; then
  echo "Passed"
else
  echo "FAILED: make sure this passes before committing code"
  RETVAL=1
fi

echo
echo "------------------------------------------------------------------------" 

# Run PHP unit tests
echo "Running PHP unit tests"
cd /buttonmen/src
php /usr/local/etc/buttonmen_phpunit.php /buttonmen/test
if [ "$?" = "0" ]; then
  echo "Passed"
else
  echo "FAILED: make sure this passes before committing code"
  RETVAL=1
fi

exit $RETVAL
