<!DOCTYPE html>
<!--
    This document should be written in polyglot HTML5/XHTML5, and therefore
    should run when served either as text/html or application/xhtml+xml.
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8" />
    <title>Choose swing values</title>
    <link rel="stylesheet" href="gui.css" />
</head>

<body>
    <div>Game #<span id="game_id">?</span></div>
    <div>Round #<span id="round_number">?</span></div>
    <br />

    <table id="die_description_table">
        <tr>
            <th>Your dice</th>
            <th>Opponent's dice</th>
        </tr>
        <tr>
            <td id="div_current_player"></td>
            <td id="div_opponent"></td>
        </tr>
    </table>

    <br />

    <div class="title2">
        Set your swing values
    </div>

    <div>
    <form action="responder.php" id="swing_values">
        <table id="swing_table">
        </table>
        <br />
        <input type="submit" value="Submit"/>
    </form>
    </div>

    <!--
    james: eventually, we will want to use the hosted version of the JQuery library
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    -->
    <script src="jquery-1.9.0.min.js"></script>
    <script>

    $(document).ready(function() {
        // global variables
        var currentPlayerIdx;
        var opponentPlayerIdx;
        var currentPlayerDieRecipeArray;
        var opponentPlayerDieRecipeArray;
        var swingRequestArray;

        function addDie(dieRecipe, parent) {
            if (document.createElement){
                $('#'+parent).append('<p>' + dieRecipe + '</p>');
            }
        }

        function displayDieDetails() {
            var dieCurrentPlayerIdx;
            var dieOpponentIdx;

            for (dieCurrentPlayerIdx = 0;
                 dieCurrentPlayerIdx < currentPlayerDieRecipeArray.length;
                 dieCurrentPlayerIdx++) {
                addDie(currentPlayerDieRecipeArray[dieCurrentPlayerIdx],
                       "div_current_player");
            }

            for (dieOpponentIdx = 0;
                 dieOpponentIdx < opponentPlayerDieRecipeArray.length;
                 dieOpponentIdx++) {
                addDie(opponentPlayerDieRecipeArray[dieOpponentIdx],
                       "div_opponent");
            }
        }

        function displaySwingDetails() {
            if (document.createElement){
                var nSwing = swingRequestArray.length;
                for (var swingIdx = 1; swingIdx <= nSwing; swingIdx++) {
                    $('#swing_table').append(
                        $('<tr>' +
                              '<td>' + swingRequestArray[swingIdx-1] + ' :</td>' +
                              '<td><input type="text" class="text" ' +
                                   'id="swing_' + swingIdx +
                                   '" ' +
                                   'size="2" maxlength="2"/></td>' +
                          '</tr>')
                    );
                }
            }
        }

        function loadGameInfo() {
            $.ajax({                                   // Do a jQuery AJAX fetch
                url: 'load_test_game_waiting_on_swing.php',
                success: function(rs, status, xhr) {
                    if (rs.status == 'ok') {
                        opponentPlayerIdx = (currentPlayerIdx + 1)%2;
                        currentPlayerDieRecipeArray = rs.data.dieRecipeArrayArray[currentPlayerIdx];
                        opponentPlayerDieRecipeArray = rs.data.dieRecipeArrayArray[opponentPlayerIdx];
                        swingRequestArray = rs.data.swingRequestArrayArray[currentPlayerIdx];

                        $('#game_id').text(rs.data.gameId);
                        $('#round_number').text(rs.data.roundNumber);

                        displayDieDetails();
                        displaySwingDetails();
                    } else {
                        $('#game_id').html("JSON fetch failed\n"+
                                           JSON.stringify(rs.data));  // We got some JSON we didn't expect (the network fetch succeeded, but the engine had an error)
                    }
                }
            });
        }

        // code to initialise game variables
        currentPlayerIdx = 1;

        // code to run when page is ready
        loadGameInfo();
    });

    </script>
</body>
</html>